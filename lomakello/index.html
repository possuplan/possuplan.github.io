<!DOCTYPE html>
<html lang="fi">
<head>
	<title>Sanapeli</title>
	<meta charset="utf-8">
  
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">


	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<meta property="og:title" content="Sanapeli">
	<meta property="og:description" content="Anagrammeja sanoista">
	
	
	<link type="text/css" href="jquery/jquery-ui.css" rel="Stylesheet" />
	<script type="text/javascript" src="jquery/jquery.min.js"></script>
	<script type="text/javascript" src="jquery/jquery-ui.min.js"></script>
	
	<script src="riffwave.js"></script>
	<script src="sfxr.js"></script>
	
</head>


<body>

<style>

html, body { 
	margin: 0;
	height: 100%;
  background-color:#222222;
}

#canvas {
	width: 100%;
	height: 100%;
	display: block;
	position: fixed;
	top: 0;
	left: 0;
	z-index: -9999;
	background-color:black;
}

@font-face {
  font-family: 'Digital';
  src: url('fonts/digital-7.mono.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

#timer {
  font-family: 'Digital', monospace;
  font-size: 48px;
  color: #00ff00;
  
  background-color:black;
  border-radius:5px;
  
  display:inline-block;
  padding:5px 10px 5px 10px;
}


.content {
  display: flex;
  justify-content: center; /* horizontal centering */
  align-items: center;     /* vertical centering */
  height: 100vh;           /* full viewport height */
}

</style>

<script>
const workingDays = [
  {date: '2025-05-02', start: '10:00', end: '18:00'},
  {date: '2025-05-03', start: '10:00', end: '18:00'},
  {date: '2025-05-04', start: '12:00', end: '18:00'},

  {date: '2025-05-05', start: '12:00', end: '20:00'},
  {date: '2025-05-08', start: '11:00', end: '19:00'},
  {date: '2025-05-09', start: '11:00', end: '19:00'},
  
  {date: '2025-05-13', start: '11:00', end: '19:00'},
  {date: '2025-05-14', start: '11:00', end: '19:00'},
  {date: '2025-05-15', start: '14:00', end: '20:00'},
  {date: '2025-05-16', start: '10:00', end: '18:00'},
  
  {date: '2025-05-19', start: '11:00', end: '19:00'},
  {date: '2025-05-20', start: '11:00', end: '19:00'},
  {date: '2025-05-21', start: '11:00', end: '19:00'},
  {date: '2025-05-24', start: '10:00', end: '18:00'},
  {date: '2025-05-25', start: '12:00', end: '18:00'},
  
  {date: '2025-05-26', start: '11:00', end: '19:00'},
  {date: '2025-05-28', start: '11:00', end: '19:00'},
  {date: '2025-05-30', start: '10:00', end: '15:00'},
  
  /**/
];

function findTodayIndex(workingDays) {
  const today = new Date().toISOString().slice(0, 10); // 'YYYY-MM-DD'

  return workingDays.findIndex(day => day.date === today);
}

function findNextWorkingDayIndex(workingDays) {
  const today = new Date().toISOString().slice(0, 10); // 'YYYY-MM-DD'

  return workingDays.findIndex(day => {
    const hasHours = day.start && day.end;
    return day.date > today && hasHours;
  });
}


function getWorkingHoursBetween(workingDays, a, b) {
  // Ensure a <= b
  const [startIndex, endIndex] = a <= b ? [a, b] : [b, a];

  let totalHours = 0;

  for (let i = startIndex; i <= endIndex; i++) {
    const day = workingDays[i];
    if (!day || !day.start || !day.end) continue; // skip if invalid or no hours

    const start = new Date(`${day.date}T${day.start}`);
    const end = new Date(`${day.date}T${day.end}`);

    totalHours += (end - start) / (1000 * 60 * 60); // convert ms to hours
  }

  return totalHours;
}

//console.log(getWorkingHoursBetween(workingDays, 0, 1));

function getWorkingHours(day) {
  const start = new Date(`${day.date}T${day.start}`);
  const end = new Date(`${day.date}T${day.end}`);
  const hours = (end - start) / (1000 * 60 * 60);
  return hours;
}

function totalWorkingHours(days) {
  return days.reduce((sum, day) => sum + getWorkingHours(day), 0);
}

function remainingHours(day, now = new Date()) {
  const start = new Date(`${day.date}T${day.start}`);
  const end = new Date(`${day.date}T${day.end}`);

  if (now < start) return (end - start) / (1000 * 60 * 60); // full day
  if (now > end) return 0; // day is over
  return (end - now) / (1000 * 60 * 60);
}


function convertDecimalHours(decimalHours) {
  const hours = Math.floor(decimalHours);
  const remainingHours = decimalHours - hours;

  const totalMinutes = remainingHours * 60;
  const minutes = Math.floor(totalMinutes);
  const remainingMinutes = totalMinutes - minutes;

  const seconds = Math.floor(remainingMinutes * 60);

  return { hours, minutes, seconds };
}

function pad2(num) {
  return String(num).padStart(2, '0');
}

$(document).ready(function(){

  let hoursRemaining = 0;
  myRepeatingFunction();

  function myRepeatingFunction(){
    let nextIndex = findNextWorkingDayIndex(workingDays);
    let todayIndex = findTodayIndex(workingDays);

    hoursRemaining = getWorkingHoursBetween(workingDays, nextIndex, workingDays.length-1);

    if(todayIndex != -1){
      hoursRemaining += remainingHours(workingDays[todayIndex]);
    }
    
    let remaining = convertDecimalHours(hoursRemaining);
    
    $("#timerHour").text(remaining.hours);
    $("#timerMin").text(pad2(remaining.minutes));
    $("#timerSec").text(pad2(remaining.seconds));
    
  }

  console.log(findTodayIndex(workingDays));

  console.log(totalWorkingHours(workingDays)); // e.g., 16


  const intervalId = setInterval(myRepeatingFunction, 1000);
  //clearInterval(intervalId);

  console.log("Hours remaining: "+hoursRemaining);

});

</script>



<div class="content">
  <div id="timer">
    <span id="timerHour"></span>:<span id="timerMin"></span>:<span id="timerSec"></span>
  </div>
</div>





</body>
</html>